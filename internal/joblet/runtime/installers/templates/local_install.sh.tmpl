#!/bin/bash
set -e

echo "Installing runtime {{.RuntimeSpec}} from local files"
cd /tmp

# Create working directory
mkdir -p runtime-build
cd runtime-build

# Files will be uploaded by the job system before this script runs
# The buildLocalCommand should handle file upload via job system

# Look for and execute setup script
if [ -f "{{.BuildScript}}" ]; then
    chmod +x "{{.BuildScript}}"
    echo "Executing {{.BuildScript}}..."
    ./{{.BuildScript}}
elif [ -f setup.sh ]; then
    chmod +x setup.sh
    echo "Executing setup.sh..."
    ./setup.sh
elif [ -f install.sh ]; then
    chmod +x install.sh
    echo "Executing install.sh..."
    ./install.sh
else
    echo "ERROR: No build script found"
    echo "Available files:"
    ls -la
    exit 1
fi

echo "Runtime {{.RuntimeSpec}} installation completed"